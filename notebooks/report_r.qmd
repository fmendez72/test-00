---
title: "VAA Synthetic Data — Exploratory Report"
subtitle: "R version"
author: "Fernando Mendez"
date: today
format:
  html:
    toc: true
    toc-depth: 2
    code-fold: true
    theme: cosmo
    self-contained: true
execute:
  warning: false
  message: false
---

## Overview

This report explores the synthetic VAA dataset generated by `src/generate_data.R`.
The dataset contains **500 simulated respondents** with positions on **10 policy issues**,
matched to 6 parties using a proximity voting model.

```{r}
library(tidyverse)

respondents <- read_csv("../data/vaa_respondents.csv")
party_pos   <- read_csv("../data/vaa_party_positions.csv")

glimpse(respondents)
```

## Vote Share

```{r}
respondents |>
  count(vote_choice) |>
  mutate(share = n / sum(n) * 100) |>
  arrange(desc(share)) |>
  ggplot(aes(x = share, y = fct_reorder(vote_choice, share))) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = sprintf("%.1f%%", share)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(limits = c(0, 65), labels = scales::label_percent(scale = 1)) +
  labs(x = "Vote share (%)", y = NULL, title = "Simulated Vote Share by Party") +
  theme_minimal()
```

## Respondent Demographics

```{r}
#| fig-width: 11
#| fig-height: 4

p_age <- ggplot(respondents, aes(x = age)) +
  geom_histogram(bins = 20, fill = "steelblue", colour = "white") +
  labs(title = "Age Distribution", x = "Age", y = "Count") +
  theme_minimal()

p_gender <- respondents |>
  count(gender) |>
  ggplot(aes(x = "", y = n, fill = gender)) +
  geom_col(width = 1) +
  coord_polar("y") +
  labs(title = "Gender", fill = NULL) +
  theme_void()

p_edu <- respondents |>
  count(education) |>
  mutate(education = factor(education, levels = c("primary", "secondary", "tertiary"))) |>
  ggplot(aes(x = education, y = n)) +
  geom_col(fill = "steelblue", colour = "white") +
  labs(title = "Education Level", x = NULL, y = "Count") +
  theme_minimal()

library(patchwork)
p_age | p_gender | p_edu
```

## Party Positions on Policy Issues

```{r}
#| fig-width: 11
#| fig-height: 5

party_pos |>
  ggplot(aes(x = issue, y = party, fill = position)) +
  geom_tile(colour = "white") +
  geom_text(aes(label = position), size = 3) +
  scale_fill_gradient2(low = "tomato", mid = "white", high = "steelblue",
                       midpoint = 0, limits = c(-2, 2),
                       name = "Position\n(−2 to +2)") +
  labs(x = NULL, y = NULL, title = "Party Positions by Issue") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Mean Respondent Positions by Vote Choice

```{r}
#| fig-width: 11
#| fig-height: 5

issues <- c("tax_policy", "climate_action", "immigration", "healthcare",
            "education_spending", "eu_integration", "pension_reform",
            "defence_spending", "drug_policy", "electoral_reform")

respondents |>
  group_by(vote_choice) |>
  summarise(across(all_of(issues), mean)) |>
  pivot_longer(-vote_choice, names_to = "issue", values_to = "mean_pos") |>
  ggplot(aes(x = issue, y = vote_choice, fill = mean_pos)) +
  geom_tile(colour = "white") +
  geom_text(aes(label = round(mean_pos, 1)), size = 3) +
  scale_fill_gradient2(low = "tomato", mid = "white", high = "steelblue",
                       midpoint = 0, limits = c(-2, 2),
                       name = "Mean\nposition") +
  labs(x = NULL, y = NULL, title = "Mean Respondent Positions by Vote Choice") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
